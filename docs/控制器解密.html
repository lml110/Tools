<!DOCTYPE html>
<html class="">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no,address=no,email=no">
    <title>控制器解密</title>
    <link rel="stylesheet" href="https://res.wyins.net/autoUpload/common/vant3_lib_9adb7133f61ff10.css" />
    <!-- <script src="http://cdn.xsmore.com/Script/common/jquery-1.8.0.min.js"></script> -->
    <script src="https://res.wyins.net/autoUpload/common/a03eebe9-666d-4f91-88cf-596549f31ef0.js"></script>
    <style>
    .app {
        max-width: 750px;
        margin: 0 auto;
    }
    
    .row {
        overflow: hidden;
        padding: 14px 0;
        display: -webkit-box;
        -webkit-box-align: center;
    }
    
    .van-col {
        padding: 10px 0;
    }
    
    [v-cloak] {
        display: none;
    }
    
    .title {
        font-weight: bold;
        font-size: 22px;
        padding: 40px 0 0;
    }
    
    .label {
        font-weight: bold;
        font-size: 18px;
    }
    
    .button-box {
        padding: 50px 0;
    }
    
    .button-box .van-button {
        margin: 0 20px;
    }
    
    .main {
        margin-top: 30px;
    }
    .red{
        color: red;
    }
    .create_input{
        background-color: #efefef;
    }
    </style>
</head>

<body>
    <div id="app" class="app" v-cloak>
        <van-row>
            <!-- <van-col span="24" :align="col_align" class="title">必须保证两边控制开关总和为{{result}}</van-col> -->
            <van-col span="24" :align="col_align" class="title">控制开关两端的数目和必须均为{{result}}</van-col>
        </van-row>
        <van-row>
            <van-col span="24" :align="col_align" class="desc">开关激活指向的是下方数字</van-col>
        </van-row>
        <van-row class="main">
            <van-col :span="col_span" :class="labelClass" :align="col_align" v-for="item in indexList">{{labelData[controllerData[0][item]]}}</van-col>
        </van-row>
        <van-row>
            <van-col :span="col_span" :align="col_align" v-for="(item,idx) in controllers">
                <van-switch v-model="controllers[idx]" size="24px" />
            </van-col>
        </van-row>
        <van-row>
            <van-col :span="col_span" :class="labelClass" :align="col_align" v-for="item in indexList">{{labelData[controllerData[1][item]]}}</van-col>
        </van-row>
        <van-row>
            <van-col span="24" :align="col_align" class="button-box">
                <van-button type="primary" @click="click_verify">解谜</van-button>
                <van-button type="success" @click="click_answer" v-if="show_answer">获取答案</van-button>
                <van-button type="primary" @click="click_reset">重置</van-button>
            </van-col>
        </van-row>
        <van-row>
            <van-col span="24" :align="col_align" class="desc">
                <div>下方可随机生成控制开关的数值</div>
                <div>数目和最好在8到24之间</div>
            </van-col>
        </van-row>
        <van-row>
            <van-col span="24">
                <van-cell-group inset >
                    <van-field class="create_input" v-model="result_input" center label="生成的数目和"  placeholder="请输入生成的总和">
                        <template #button>
                            <van-button @click="setRandomController" size="small" :loading="create_loading" type="primary">随机生成</van-button>
                        </template>
                    </van-field>
                </van-cell-group>
            </van-col>
        </van-row>
        <van-row v-show="create_err">
            <van-col span="24" :align="col_align" class="desc">
                <div class="red">生成错误，请重新生成</div>
            </van-col>
        </van-row>
    </div>
    <script src="https://res.wyins.net/autoUpload/common/vue3_5085a3714fada0a.js"></script>
    <!-- <script src="https://res.wyins.net/autoUpload/common/vant_e251264d67d5ad2.js"></script> -->
    <script src="https://res.wyins.net/autoUpload/common/vant.min_acbe76394646264.js"></script>
    <script></script>
    <script type="text/javascript">
    // const { Notify } = vant;

    //获取控制器组合的全部排列
    function getPermutation(indexList) {
        const resList = []
            //排除1的排列
        for (let i = 2, len = indexList.length - 1; i < len; i++) {
            resList.push(...getCombine(indexList, i))
        };
        return resList;
    }
    const {
        getCombine, _for, _getParams, _toNumber, _timeout
    } = tools
    const app = Vue.createApp({
        // template: `<van-button>按钮</van-button>`,
        // template: '#schedule-Template',
        data: function() {
            const controllerData = [
                [3, 3, 5, 1, 2, 4],
                [1, 5, 6, 5, 2, 2],
            ]
            const controllerDataLen = controllerData[0].length
            const indexList = Array.from({
                length: controllerDataLen
            }, (_, i) => i)
            const col_span = 24 / controllerDataLen
            const controllers = Array.from({
                length: controllerDataLen
            }, _ => false)
            const labelData = {
                '1': 'Ⅰ',
                '2': 'Ⅱ',
                '3': 'Ⅲ',
                '4': 'Ⅳ',
                '5': 'Ⅴ',
                '6': 'Ⅵ',
                '7': 'Ⅶ',
                '8': 'Ⅷ',
                '9': 'Ⅸ',
                '10': 'Ⅹ',
            }
            return {
                controllerData,
                result: 8,
                result_input: 17,

                indexList,
                col_span,
                labelData,
                create_loading: false,

                show_answer: false,
                col_align: 'center',
                labelClass: 'label',
                controllers,
                create_err: false,
            }
        },
        created() {},
        mounted() {
            this.times = new _timeout()
            // Notify({ type: 'warning', message: '通知内容' });、
            this.show_answer = _getParams('', 'lml') ? true : false
        },
        methods: {
            _message(message,type = 'warning'){
                return this.$notify({
                    type, message, duration: 800
                })
            },
            _tips(is) {
                const type = is ? 'success' : 'warning'
                const message = is ? '恭喜解密成功' : '解密失败，请再接再厉'
                return this._message(message,type)
            },
            click_answer() {
                this.getAnswer();
                this._tips(1)
            },
            click_reset() {
                _for(this.controllers, (el, ix) => {
                    this.controllers[ix] = false;
                })
            },
            click_verify() {
                const controllers = [];
                const controllerData = this.controllerData;
                _for(this.controllers, (el, ix) => {
                    if (el) controllers.push(ix)
                })
                const verify = this.verifyController(controllers, controllerData[1], controllerData[0])
                return this._tips(verify)
            },
            //验证两边数组
            verifyController(controllers, res1, res2) {
                const controllerData = this.controllerData;
                let ifs1 = this.verifyReslut(res1, controllers);
                if (ifs1) {
                    let per_not = this.notCheck(controllers);
                    let ifs2 = this.verifyReslut(res2, per_not)
                    return ifs2 ? per_not : false
                } else {
                    return false
                }
            },
            //验证结果
            //控制器数组是否等于reslut
            verifyReslut(arr, per, reslut = this.result) {
                let res = 0
                let reslist = []
                for (let i = 0, len = per.length; i < len; i++) {
                    let item = arr[per[i]]
                    res += item
                    reslist.push(item)
                    if (res > reslut) {
                        return null;
                    }
                };
                return res === reslut ? reslist : null;
            },
            //反向查询 == 向下的激活开关
            notCheck(per, indexList = this.indexList) {
                let res = [];
                _for(indexList, el => {
                    if (!per.includes(el)) res.push(el)
                })
                return res;
            },
            //获取答案
            getAnswer() {
                const Controller = this.getController(this.controllerData, this.result)
                const controllers = this.controllers
                    // console.log(Controller);
                _for(controllers, (el, ix) => {
                    if (Controller.includes(ix)) controllers[ix] = true;
                })
            },
            getController(list, reslut) {
                const indexList = this.indexList;
                const res1 = list[0]
                const res2 = list[1]
                    //反向查询 == 向下的激活开关
                    // const not_check = function(per) {
                    //     let res = [];
                    //     _for(indexList, el => {
                    //         if (!per.includes(el)) res.push(el)
                    //     })
                    //     return res;
                    // }
                const not_check = this.notCheck;

                //控制器数组是否等于reslut
                // const if_reslut = function(arr, per) {
                //     let res = 0
                //     let reslist = []
                //     for (let i = 0, len = per.length; i < len; i++) {
                //         let item = arr[per[i]]
                //         res += item
                //         reslist.push(item)
                //         if (res > reslut) {
                //             return null;
                //         }
                //     };
                //     return res === reslut ? reslist : null;
                // }
                const if_reslut = this.verifyReslut

                const perlist = getPermutation(indexList);
                for (let i = 0, len = perlist.length; i < len; i++) {
                    let per = perlist[i]
                        // let ifs1 = if_reslut(res1, per)
                        // if (ifs1) {
                        //     // console.log(ifs1,per);
                        //     let per_not = not_check(per);
                        //     let ifs2 = if_reslut(res2, per_not)
                        //     if (ifs2) {
                        //         // console.log(ifs2,per_not,ifs1);
                        //         return per_not;
                        //     }
                        // }
                    const ifs = this.verifyController(per, res1, res2)
                        // console.log(ifs);
                    if (ifs) return ifs
                };

                // console.time("getCombine计时");
                // console.log(getCombine(indexList, 1));
                // console.timeEnd("getCombine计时");
                return [];
            },
            //获取随机元素
            _getRandomNum(sum, max) {
                let diff = 1
                let cont = 11 - diff
                    // console.log(diff,cont);
                let res = Math.floor(Math.random() * cont + diff);
                //不能获取超过总和的值
                // if (max && (sum + res > max)) { //会导致内存崩溃
                if (max && res > max) {
                    // console.log('测试内存-a',sum, res, max);
                    res = this._getRandomNum(sum, max)
                }
                return res;
            },
            //获取组成结果的随机元素
            _getRandomData(controller) {
                const reslut = this.result;
                const len = controller.length
                const last = len - 1
                let resList = []
                let cont = 0
                _for(controller, (el, ix) => {
                    if (ix === last) resList.push(reslut - cont);
                    else {
                        let num = this._getRandomNum(cont, reslut - len);
                        cont += num;
                        resList.push(num);
                    }
                });
                //不能获取超过10的数据与小于1的
                if (resList[last] <= 0 || resList[last] > 10) {
                    resList = this._getRandomData(controller)
                }
                return resList;
            },
            //获取数据的其他元素
            _getOtherRandomData(controller, data) {
                const indexList = this.indexList;
                let resList = []
                _for(indexList, (el, ix) => {
                    let index = controller.indexOf(ix)
                    if (index !== -1) resList[ix] = data[index];
                    else resList[ix] = this._getRandomNum();
                });
                return resList;
            },
            getRandomController() {
                const indexList = this.indexList;
                const perlist = getPermutation(indexList);
                const per_index = Math.floor(Math.random() * perlist.length);
                const controller = perlist[per_index]

                let data1 = this._getRandomData(controller)
                let per_not = this.notCheck(controller);
                let data2 = this._getRandomData(per_not)
                data1 = this._getOtherRandomData(controller, data1);
                data2 = this._getOtherRandomData(per_not, data2);

                //lml
                // console.log('key= ',controller,per_not);
                // console.log('data= ',data1,data2);
                this.controllerData = [data1, data2]
            },
            //设置随机总和
            setRandomController() {
                let result = _toNumber(this.result_input)
                let msg = '';
                if(!result) msg = '请填写正确的数值';
                if(result<8 || result > 24) msg = '数目和数值最好在8到24之间';
                if(msg) return this._message(msg);
                this.create_loading = true;
                this.click_reset();
                this.result = result;
                this.create_err = false;
                try{
                    this.getRandomController()
                }catch(err){
                    console.log(err);
                    this.create_err = true;
                    this._message('生成错误，请重新生成');
                };
                // return this.create_loading = false;
                this.times.start(()=>{
                    this.create_loading = false;
                },300)
            },
        }
    });
    app.use(vant);

    // 通过 CDN 引入时不会自动注册 Lazyload 组件
    // 可以通过下面的方式手动注册
    app.use(vant.Lazyload)
    app.mount('#app');
    /*
    
    已知两组数据，通过控制操作，得出两边结果都为8
     */
    </script>
</body>

</html>
