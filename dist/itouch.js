/*! For license information please see itouch.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("itouch",[],e):"object"==typeof exports?exports.itouch=e():t.itouch=e()}(self,(function(){return function(){"use strict";var t={};const e="ontouchstart"in window,s=e?"touchstart":"mousedown",i=e?"touchmove":"mousemove",o=e?"touchend":"mouseup",n=e?"touchcancel":"mouseleave";return t.default=class{constructor(t,e){this.isWebkit3dTransform="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,this.node="object"==typeof t?t:document.querySelector(t),this.options=Object.assign({scalable:!1,rotatable:!1,transform:"transform",isSpinner:!0,spinner:"",orientFn:null,startFn:null,moveFn:null,endFn:null},e),this.spinner=this.options.spinner?document.querySelector(this.options.spinner):this.node,this.orient={x:0,y:0},this.start_orient={},this.touchObj={},this.init()}init(){this.rotation=0,this.scale=1,this.gesture=!1,this.curX=0,this.curY=0,this.node.addEventListener(s,this.touchstart.bind(this),!1),this.node.addEventListener(i,this.touchmove.bind(this),!1),this.node.addEventListener(o,this.touchend.bind(this),!1),this.node.addEventListener(n,this.touchcancel.bind(this),!1)}_recovery(t){let e=this.getPageSize(t),s=this.getMatrix(),i=0,o=0;this.start_orient=e,s&&(i=s[0],o=s[1]),this.start0X=e[0].x-i,this.start0Y=e[0].y-o,e[1]?(this.origin=e,this.start1X=e[1].x-i,this.start1Y=e[1].y-o,this.gesture=!0):this.gesture=!1}getTouchObj(t){let e={scale:this.scale,rotation:this.rotation,curX:this.curX,curY:this.curY};return t&&(e.size=this.getPageSize(t)),e}touchstart(t){t.preventDefault(),this._recovery(t),this.options.startFn&&this.options.startFn(this.getTouchObj(t))}touchmove(t){t.preventDefault();let e="",s=this.options.transform,i=this.getPageSize(t),o={};if(this.gesture){let t=i[0].x-this.start0X,e=i[0].y-this.start0Y,s=i[1].x-this.start1X,o=i[1].y-this.start1Y;this.curX=(t+s)/2,this.curY=(e+o)/2}else this.curX=i[0].x-this.start0X,this.curY=i[0].y-this.start0Y;if(o={curX:this.curX,curY:this.curY,size:i},e+=this._translate(this.curX,this.curY),this.gesture){if(this.options.scalable){let s=this._scale(i)/this._scale(this.origin),n=t.scale||s;o.scale=this.scale*n,e+="scale("+o.scale+")"}if(this.options.rotatable){let s=Math.round(180*(this._rotate(this.origin)-this._rotate(i))/Math.PI),n=t.rotation||s;o.rotation=this.rotation+n,e+="rotate("+o.rotation%360+"deg)",e+="translateZ(0)"}}else this.options.scalable&&(o.scale=this.scale,e+="scale("+o.scale+")"),this.options.rotatable&&(o.rotation=this.rotation,e+="rotate("+o.rotation%360+"deg)",e+="translateZ(0)");(this.options.scalable||this.options.rotatable)&&(t.scale||(this.touchObj.scale=o.scale),t.rotation||(this.touchObj.rotation=o.rotation)),this.options.moveFn&&this.options.moveFn(o),this.options.isSpinner&&(this.spinner.style[s]=e)}_endTouch(t){if(t.preventDefault(),this.gesture&&(this.options.scalable&&(t.scale?this.scale*=t.scale:this.scale=this.touchObj.scale||0),this.options.rotatable&&(t.rotation?this.rotation+=t.rotation:this.rotation=this.touchObj.rotation||0),this.gesture=!1),t.touches&&t.touches.length)this.touchstart(t);else{if(this.options.orientFn){let e=this.getTouches(t).changedTouches,s=e[0].pageX,i=e[0].pageY,o=this.start_orient[0].x,n=this.start_orient[0].y;return e[1]&&this.start_orient[1]&&(s=(e[0].pageX+e[0].pageX)/2,i=(e[0].pageY+e[0].pageY)/2,o=(this.start_orient[0].x+this.start_orient[0].x)/2,n=(this.start_orient[0].y+this.start_orient[0].y)/2),this.orient.x=s>o?2:s<o?1:0,this.orient.y=i>n?2:i<n?1:0,this.options.orientFn&&this.options.orientFn(this.orient,this.getTouchObj(t))}this.options.endFn&&this.options.endFn(this.getTouchObj(t))}}touchend(t){this._endTouch(t)}touchcancel(t){this._endTouch(t)}_translate(t,e,s=""){return this.isWebkit3dTransform?s+="translate3d("+t+"px,"+e+"px, 0)":s+="translate("+t+"px,"+e+"px)",s}_rotate(t){return Math.atan2(t[1].x-t[0].x,t[1].y-t[0].y)}_scale(t){return Math.sqrt(Math.pow(t[1].x-t[0].x,2)+Math.pow(t[1].y-t[0].y,2))}getMatrix(t){let e=this.spinner.style[this.options.transform];if(!e)return 0;let s=e.split("(")[1].split(")")[0].split(",").map(((t,e)=>Number(t.replace("px",""))));return s[t]||s}getPageSize(t){let s,i,o=[];if(e){let e=this.getTouches(t);if(!e.targetTouches||!e.targetTouches.length)return!1;if(s=e.targetTouches[0].pageX,i=e.targetTouches[0].pageY,t.touches&&t.touches[1]){let t=e.targetTouches[1];o[1]={x:t.pageX,y:t.pageY}}}else s=t.pageX,i=t.pageY;return o[0]={x:s,y:i},o}getTouches(t){return{changedTouches:this.getToucheOption(t.changedTouches),touches:this.getToucheOption(t.touches),targetTouches:this.getToucheOption(t.targetTouches)}}getToucheOption(t){let e=[];for(let s=0;s<t.length;s++)e.push({pageX:t[s].pageX,pageY:t[s].pageY,clientX:t[s].clientX,clientY:t[s].clientY,screenX:t[s].screenX,screenY:t[s].screenY});return e}removeEvent(){this.node.removeEventListener(s,this.touchstart.bind(this),!1),this.node.removeEventListener(i,this.touchmove.bind(this),!1),this.node.removeEventListener(o,this.touchend.bind(this),!1),this.node.removeEventListener(n,this.touchcancel.bind(this),!1)}},t.default}()}));